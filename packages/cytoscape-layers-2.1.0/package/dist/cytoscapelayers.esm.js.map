{"version":3,"file":"cytoscapelayers.esm.js","sources":["../src/layers/utils.ts","../src/layers/ABaseLayer.ts","../src/layers/ADOMBaseLayer.ts","../src/layers/SVGLayer.ts","../src/layers/CanvasLayer.ts","../src/layers/HTMLLayer.ts","../src/layers/CytoscapeLayer.ts","../src/elements/utils.ts","../src/elements/common.ts","../src/elements/edges.ts","../src/elements/nodes.ts","../src/LayersPlugin.ts","../src/index.ts"],"sourcesContent":["export const layerStyle: Partial<CSSStyleDeclaration> = {\n  position: 'absolute',\n  left: '0',\n  top: '0',\n  userSelect: 'none',\n  outlineStyle: 'none',\n  width: '100%',\n  height: '100%',\n};\n\nfunction stop(e: Event) {\n  e.stopPropagation();\n}\n\nexport function stopClicks(node: SVGElement | HTMLElement) {\n  node.addEventListener('click', stop);\n  node.addEventListener('mousedown', stop);\n  node.addEventListener('mouseup', stop);\n  node.addEventListener('mousemove', stop);\n}\n","import {\n  ICanvasLayer,\n  IHTMLLayer,\n  IMoveAbleLayer,\n  ISVGLayer,\n  ILayer,\n  IHTMLStaticLayer,\n  ISVGStaticLayer,\n  ICanvasStaticLayer,\n} from './interfaces';\nimport cy from 'cytoscape';\nimport { ICanvasLayerOptions, ISVGLayerOptions, IHTMLLayerOptions } from './public';\n\nexport interface ILayerAdapter {\n  cy: cy.Core;\n  move(layer: IMoveAbleLayer, offset: number): void;\n  insert(\n    where: 'before' | 'after',\n    layer: IMoveAbleLayer,\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ICanvasLayerOptions | ISVGLayerOptions\n  ): ILayer;\n  inVisibleBounds(p: { x: number; y: number } | cy.BoundingBox12): boolean;\n}\n\nexport abstract class ABaseLayer implements IMoveAbleLayer {\n  private updateOnRenderEnabled = false;\n\n  constructor(private readonly adapter: ILayerAdapter) {}\n\n  inVisibleBounds(p: { x: number; y: number } | cy.BoundingBox12) {\n    return this.adapter.inVisibleBounds(p);\n  }\n\n  get updateOnRender() {\n    return this.updateOnRenderEnabled;\n  }\n\n  set updateOnRender(value: boolean) {\n    if (this.updateOnRenderEnabled === value) {\n      return;\n    }\n    this.updateOnRenderEnabled = value;\n    if (value) {\n      this.cy.on('render', this.update);\n    } else {\n      this.cy.off('render', undefined, this.update);\n    }\n  }\n\n  abstract readonly update: () => void;\n\n  get cy() {\n    return this.adapter.cy;\n  }\n\n  moveUp() {\n    this.adapter.move(this, -1);\n  }\n  moveDown() {\n    this.adapter.move(this, 1);\n  }\n  moveBack() {\n    this.adapter.move(this, Number.NEGATIVE_INFINITY);\n  }\n  moveFront() {\n    this.adapter.move(this, Number.POSITIVE_INFINITY);\n  }\n\n  insertBefore(type: 'svg', options?: ISVGLayerOptions): ISVGLayer;\n  insertBefore(type: 'svg-static', options?: ISVGLayerOptions): ISVGStaticLayer;\n  insertBefore(type: 'canvas', options?: ICanvasLayerOptions): ICanvasLayer;\n  insertBefore(type: 'canvas-static', options?: ICanvasLayerOptions): ICanvasStaticLayer;\n  insertBefore(type: 'html', options?: IHTMLLayerOptions): IHTMLLayer;\n  insertBefore(type: 'html-static', options?: IHTMLLayerOptions): IHTMLStaticLayer;\n  insertBefore(\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ) {\n    return this.adapter.insert('before', this, type, options);\n  }\n\n  insertAfter(type: 'svg', options?: ISVGLayerOptions): ISVGLayer;\n  insertAfter(type: 'svg-static', options?: ISVGLayerOptions): ISVGStaticLayer;\n  insertAfter(type: 'canvas', options?: ICanvasLayerOptions): ICanvasLayer;\n  insertAfter(type: 'canvas-static', options?: ICanvasLayerOptions): ICanvasStaticLayer;\n  insertAfter(type: 'html', options?: IHTMLLayerOptions): IHTMLLayer;\n  insertAfter(type: 'html-static', options?: IHTMLLayerOptions): IHTMLStaticLayer;\n  insertAfter(\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ) {\n    return this.adapter.insert('after', this, type, options);\n  }\n}\n","import { ILayerElement } from './interfaces';\nimport { IDOMUpdateFunction } from './public';\nimport { layerStyle } from './utils';\nimport { ABaseLayer, ILayerAdapter } from './ABaseLayer';\n\nexport abstract class ADOMBaseLayer<T extends HTMLElement | SVGElement> extends ABaseLayer {\n  readonly root: T & ILayerElement;\n  readonly callbacks: IDOMUpdateFunction<T>[] = [];\n\n  constructor(adapter: ILayerAdapter, root: T) {\n    super(adapter);\n    this.root = (root as unknown) as T & ILayerElement;\n    Object.assign(this.root.style, layerStyle);\n  }\n\n  abstract get node(): T;\n\n  readonly update = () => {\n    for (const o of this.callbacks) {\n      o(this.node);\n    }\n  };\n\n  get visible() {\n    return this.root.style.display !== 'none';\n  }\n\n  set visible(value: boolean) {\n    if (this.visible == value) {\n      return;\n    }\n    this.root.style.display = value ? '' : 'none';\n  }\n\n  show() {\n    this.visible = true;\n  }\n  hide() {\n    this.visible = false;\n  }\n\n  callback(callback: IDOMUpdateFunction<T>) {\n    this.callbacks.push(callback);\n    this.update();\n    return this;\n  }\n\n  resize() {\n    // dummy\n  }\n\n  remove() {\n    this.root.remove();\n  }\n}\n","import { ILayerAdapter } from './ABaseLayer';\nimport { ADOMBaseLayer } from './ADOMBaseLayer';\nimport { ILayerElement, ILayerImpl, ISVGLayer, ISVGStaticLayer } from './interfaces';\nimport { ISVGLayerOptions } from './public';\nimport { stopClicks } from './utils';\n\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\nexport class SVGLayer extends ADOMBaseLayer<SVGElement> implements ISVGLayer, ILayerImpl {\n  readonly type = 'svg';\n  readonly node: SVGGElement & ILayerElement;\n  updateOnTransform = false;\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: ISVGLayerOptions = {}) {\n    super(adapter, doc.createElementNS(SVG_NS, 'svg'));\n    this.root.__cy_layer = this;\n    this.node = (doc.createElementNS(SVG_NS, 'g') as unknown) as SVGGElement & ILayerElement;\n    this.node.__cy_layer = this;\n    this.root.appendChild(this.node);\n    if (options.stopClicks) {\n      stopClicks(this.node);\n    }\n  }\n\n  setViewport(tx: number, ty: number, zoom: number) {\n    this.node.setAttribute('transform', `translate(${tx},${ty})scale(${zoom})`);\n    if (this.updateOnTransform) {\n      this.update();\n    }\n  }\n}\n\nexport class SVGStaticLayer extends ADOMBaseLayer<SVGElement> implements ISVGStaticLayer, ILayerImpl {\n  readonly type = 'svg-static';\n  readonly node: SVGGElement & ILayerElement;\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: ISVGLayerOptions = {}) {\n    super(adapter, doc.createElementNS(SVG_NS, 'svg'));\n    this.root.__cy_layer = this;\n    this.node = (doc.createElementNS(SVG_NS, 'g') as unknown) as SVGGElement & ILayerElement;\n    this.node.__cy_layer = this;\n    this.root.appendChild(this.node);\n    if (options.stopClicks) {\n      stopClicks(this.node);\n    }\n  }\n\n  setViewport() {\n    // dummy\n  }\n}\n","import { ICanvasLayer, ILayerElement, ILayerImpl, IRenderFunction, ICanvasStaticLayer } from './interfaces';\nimport { layerStyle, stopClicks } from './utils';\nimport { ABaseLayer, ILayerAdapter } from './ABaseLayer';\nimport { ICanvasLayerOptions } from './public';\n\nexport class CanvasBaseLayer extends ABaseLayer implements ILayerImpl {\n  readonly node: HTMLCanvasElement & ILayerElement;\n  readonly ctx: CanvasRenderingContext2D;\n  protected readonly pixelRatio: number;\n  readonly callbacks: IRenderFunction[] = [];\n  protected readonly transform: { tx: number; ty: number; zoom: number } = {\n    tx: 0,\n    ty: 0,\n    zoom: 1,\n  };\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: ICanvasLayerOptions = {}) {\n    super(adapter);\n    this.node = (doc.createElement('canvas') as unknown) as HTMLCanvasElement & ILayerElement;\n    Object.assign(this.node.style, layerStyle);\n    if (options.stopClicks) {\n      stopClicks(this.node);\n    }\n    this.pixelRatio = options.pixelRatio ?? (window ?? {}).devicePixelRatio ?? 1;\n    this.ctx = this.node.getContext('2d', options)!;\n    this.ctx.resetTransform();\n  }\n\n  get visible() {\n    return this.node.style.display !== 'none';\n  }\n\n  set visible(value: boolean) {\n    this.node.style.display = value ? '' : 'none';\n  }\n  show() {\n    this.visible = true;\n  }\n  hide() {\n    this.visible = false;\n  }\n\n  get root() {\n    return this.node;\n  }\n\n  callback(callback: IRenderFunction) {\n    this.callbacks.push(callback);\n    this.update();\n    return this;\n  }\n\n  readonly update = () => this.draw();\n\n  clear() {\n    const ctx = this.ctx;\n    const bak = ctx.getTransform();\n    ctx.resetTransform();\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.setTransform(bak);\n  }\n\n  draw() {\n    this.clear();\n    this.ctx.save();\n    this.ctx.resetTransform();\n    this.ctx.scale(this.pixelRatio, this.pixelRatio);\n    this.ctx.translate(this.transform.tx, this.transform.ty);\n    this.ctx.scale(this.transform.zoom, this.transform.zoom);\n\n    for (const r of this.callbacks) {\n      r(this.ctx);\n    }\n\n    this.ctx.restore();\n  }\n\n  resize(width: number, height: number) {\n    this.node.width = width * this.pixelRatio;\n    this.node.height = height * this.pixelRatio;\n    this.update();\n  }\n\n  setViewport(_tx: number, _ty: number, _zoom: number) {\n    // dummy\n  }\n\n  remove() {\n    this.node.remove();\n  }\n}\n\nexport class CanvasLayer extends CanvasBaseLayer implements ICanvasLayer {\n  readonly type = 'canvas';\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: ICanvasLayerOptions = {}) {\n    super(adapter, doc, options);\n    this.node.__cy_layer = this;\n  }\n\n  setViewport(tx: number, ty: number, zoom: number) {\n    this.transform.tx = tx;\n    this.transform.ty = ty;\n    this.transform.zoom = zoom;\n    this.update();\n  }\n}\n\nexport class CanvasStaticLayer extends CanvasBaseLayer implements ICanvasStaticLayer {\n  readonly type = 'canvas-static';\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: ICanvasLayerOptions = {}) {\n    super(adapter, doc, options);\n    this.node.__cy_layer = this;\n  }\n}\n","import { ILayerAdapter } from './ABaseLayer';\nimport { ADOMBaseLayer } from './ADOMBaseLayer';\nimport { IHTMLLayer, IHTMLStaticLayer, ILayerElement, ILayerImpl } from './interfaces';\nimport { IHTMLLayerOptions } from './public';\nimport { stopClicks } from './utils';\n\nexport class HTMLLayer extends ADOMBaseLayer<HTMLElement> implements IHTMLLayer, ILayerImpl {\n  readonly type = 'html';\n  readonly node: HTMLDivElement & ILayerElement;\n  updateOnTransform = false;\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: IHTMLLayerOptions = {}) {\n    super(adapter, doc.createElement('div'));\n    this.root.__cy_layer = this;\n    this.node = (doc.createElement('div') as unknown) as HTMLDivElement & ILayerElement;\n    this.node.__cy_layer = this;\n    this.node.style.position = 'absolute';\n    this.node.style.left = '0px';\n    this.node.style.top = '0px';\n    this.root.appendChild(this.node);\n    if (options.stopClicks) {\n      stopClicks(this.node);\n    }\n  }\n\n  setViewport(tx: number, ty: number, zoom: number) {\n    this.node.style.transform = `translate(${tx}px,${ty}px)scale(${zoom})`;\n    if (this.updateOnTransform) {\n      this.update();\n    }\n  }\n}\n\nexport class HTMLStaticLayer extends ADOMBaseLayer<HTMLElement> implements IHTMLStaticLayer, ILayerImpl {\n  readonly type = 'html-static';\n\n  constructor(adapter: ILayerAdapter, doc: Document, options: IHTMLLayerOptions = {}) {\n    super(adapter, doc.createElement('div'));\n    this.node.__cy_layer = this;\n    if (options.stopClicks) {\n      stopClicks(this.node);\n    }\n  }\n\n  get node() {\n    return this.root;\n  }\n\n  setViewport() {\n    // dummy\n  }\n}\n","import { ABaseLayer, ILayerAdapter } from './ABaseLayer';\nimport {\n  ICytoscapeDragLayer,\n  ICytoscapeNodeLayer,\n  ICytoscapeSelectBoxLayer,\n  ILayerElement,\n  ILayerImpl,\n} from './interfaces';\n\nexport class CytoscapeBaseLayer extends ABaseLayer implements ILayerImpl {\n  readonly node: HTMLCanvasElement & ILayerElement;\n\n  constructor(adapter: ILayerAdapter, node: HTMLCanvasElement) {\n    super(adapter);\n    this.node = (node as unknown) as HTMLCanvasElement & ILayerElement;\n  }\n\n  get root() {\n    return this.node;\n  }\n\n  readonly update = () => {};\n\n  resize() {}\n\n  setViewport() {}\n\n  remove() {}\n}\n\nexport class CytoscapeNodeLayer extends CytoscapeBaseLayer implements ICytoscapeNodeLayer {\n  readonly type = 'node';\n\n  constructor(adapter: ILayerAdapter, node: HTMLCanvasElement) {\n    super(adapter, node);\n    this.node.__cy_layer = this;\n  }\n}\n\nexport class CytoscapeDragLayer extends CytoscapeBaseLayer implements ICytoscapeDragLayer {\n  readonly type = 'drag';\n\n  constructor(adapter: ILayerAdapter, node: HTMLCanvasElement) {\n    super(adapter, node);\n    this.node.__cy_layer = this;\n  }\n}\n\nexport class CytoscapeSelectBoxLayer extends CytoscapeBaseLayer implements ICytoscapeSelectBoxLayer {\n  readonly type = 'select-box';\n\n  constructor(adapter: ILayerAdapter, node: HTMLCanvasElement) {\n    super(adapter, node);\n    this.node.__cy_layer = this;\n  }\n}\n","import cy from 'cytoscape';\n\nexport interface IMatchOptions<T extends HTMLElement | SVGElement> {\n  bb: (node: cy.NodeSingular) => cy.BoundingBox12 & cy.BoundingBoxWH;\n  isVisible: (bb: cy.BoundingBox12 & cy.BoundingBoxWH) => boolean;\n  enter: (node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => T;\n  update: (elem: T, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => void;\n  uniqueElements: boolean;\n}\n\nexport function matchNodes<T extends HTMLElement | SVGElement>(\n  root: T,\n  nodes: cy.NodeCollection,\n  options: IMatchOptions<T>\n) {\n  const arr = Array.from(root.children) as T[];\n  if (!options.uniqueElements) {\n    nodes.forEach((node) => {\n      const bb = options.bb(node);\n      if (!options.isVisible(bb)) {\n        return;\n      }\n      if (arr.length > 0) {\n        options.update(arr.shift()!, node, bb);\n      } else {\n        const elem = options.enter(node, bb);\n        root.appendChild(elem);\n        options.update(elem, node, bb);\n      }\n    });\n    for (const rest of arr) {\n      rest.remove();\n    }\n    return;\n  }\n  // match\n  const map = new Map(arr.map((d) => [d.dataset.id!, d] as [string, T]));\n\n  let i = -1;\n  nodes.forEach((node) => {\n    const bb = options.bb(node);\n    if (!options.isVisible(bb)) {\n      return;\n    }\n    i++;\n    const id = node.id();\n    const expected = arr[i];\n    const has = map.get(id);\n    let n: T;\n    if (has) {\n      options.update(has, node, bb);\n      map.delete(id);\n      if (expected === has) {\n        // match 1:1\n        return;\n      }\n      n = has;\n    } else {\n      // need a new one\n      n = options.enter(node, bb);\n      n.dataset.id = id;\n      options.update(n, node, bb);\n    }\n\n    if (i === 0) {\n      root.insertAdjacentElement('afterbegin', n);\n    } else {\n      arr[i - 1].insertAdjacentElement('afterend', n);\n    }\n    arr.splice(i, 0, n);\n  });\n  // delete rest\n  map.forEach((n) => n.remove());\n}\n\nexport interface ICallbackRemover {\n  remove(): void;\n}\n\nexport function registerCallback<U, T extends { callback(c: U): void; callbacks: U[] }>(\n  layer: T,\n  renderer: U\n): ICallbackRemover {\n  layer.callback(renderer);\n  return {\n    remove: () => {\n      layer.callbacks.splice(layer.callbacks.indexOf(renderer), 1);\n    },\n  };\n}\n","export interface IElementLayerOptions {\n  /**\n   * selector to determine elements to render\n   * @default :visible\n   */\n  selector: string;\n  /**\n   * whether to update the collection on each update\n   */\n  queryEachTime: boolean;\n  /**\n   * automatically update the layer upon a certain event\n   * @default auto = render in case of a queryEachTime else position\n   */\n  updateOn: 'render' | 'position' | 'none';\n\n  /**\n   * whether to check that the element is actually visible\n   * @default true\n   */\n  checkBounds: boolean;\n}\n\nexport function defaultElementLayerOptions(o?: Partial<IElementLayerOptions>): IElementLayerOptions {\n  return {\n    selector: ':visible',\n    updateOn: o != null && o.queryEachTime ? 'render' : 'position',\n    queryEachTime: false,\n    checkBounds: true,\n  };\n}\n","import cy from 'cytoscape';\nimport { ICanvasLayer, IPoint } from '../layers';\nimport { ICallbackRemover, registerCallback } from './utils';\nimport { IElementLayerOptions, defaultElementLayerOptions } from './common';\n\nexport interface IRenderPerEdgeResult extends ICallbackRemover {\n  layer: ICanvasLayer;\n  edges: cy.EdgeCollection;\n}\n\nexport interface IEdgeLayerOptions extends IElementLayerOptions {\n  checkBoundsPointCount: number;\n  /**\n   * init function for the collection\n   * @param edges\n   */\n  initCollection(edges: cy.EdgeCollection): void;\n}\n\nexport function renderPerEdge(\n  layer: ICanvasLayer,\n  render: (ctx: CanvasRenderingContext2D, edge: cy.EdgeSingular, path: Path2D, start: IPoint, end: IPoint) => void,\n  options?: Partial<IEdgeLayerOptions>\n): IRenderPerEdgeResult {\n  const o: IEdgeLayerOptions = Object.assign(\n    {\n      checkBoundsPointCount: 5,\n      initCollection: () => undefined,\n    },\n    defaultElementLayerOptions(options),\n    options\n  );\n  const edges = o.queryEachTime ? layer.cy.collection() : layer.cy.edges(o.selector);\n  if (!o.queryEachTime) {\n    o.initCollection(edges);\n  }\n\n  if (o.updateOn === 'render') {\n    layer.updateOnRender = true;\n  } else if (o.updateOn === 'position') {\n    edges.on('position add remove', layer.update);\n    edges.sources().on('position', layer.update);\n    edges.targets().on('position', layer.update);\n  } else {\n    edges.on('add remove', layer.update);\n  }\n\n  const renderer = (ctx: CanvasRenderingContext2D) => {\n    const currentEdges = o.queryEachTime ? layer.cy.edges(o.selector) : edges;\n    if (o.queryEachTime) {\n      o.initCollection(currentEdges);\n    }\n    currentEdges.forEach((edge) => {\n      const impl = (edge as any)._private.rscratch as {\n        pathCache: Path2D;\n        startX?: number;\n        startY?: number;\n        endX?: number;\n        endY?: number;\n      };\n      const s =\n        impl && impl.startX != null && impl.startY != null ? { x: impl.startX, y: impl.startY } : edge.sourceEndpoint();\n      const t = impl && impl.endX != null && impl.endY != null ? { x: impl.endX, y: impl.endY } : edge.targetEndpoint();\n\n      if (o.checkBounds && o.checkBoundsPointCount > 0 && !anyVisible(layer, s, t, o.checkBoundsPointCount)) {\n        return;\n      }\n      if (impl && impl.pathCache) {\n        render(ctx, edge, impl.pathCache, s, t);\n        return;\n      }\n      const path = new Path2D();\n      path.moveTo(s.x, s.y);\n      path.lineTo(t.x, t.y);\n      render(ctx, edge, path, s, t);\n    });\n  };\n\n  const r = registerCallback(layer, renderer);\n  return {\n    layer,\n    edges,\n    remove: () => {\n      edges.off('position add remove', undefined, layer.update);\n      edges.sources().off('position', undefined, layer.update);\n      edges.targets().off('position', undefined, layer.update);\n      r.remove();\n    },\n  };\n}\n\nfunction anyVisible(layer: ICanvasLayer, s: IPoint, t: IPoint, count: number) {\n  const interpolate = (v: number) => ({\n    x: s.x * v + t.x * (1 - v),\n    y: s.y * v + t.y * (1 - v),\n  });\n  if (count === 1) {\n    return layer.inVisibleBounds(interpolate(0.5));\n  }\n  const step = 1 / count;\n  for (let i = 0; i <= count; i++) {\n    if (layer.inVisibleBounds(interpolate(i * step))) {\n      return true;\n    }\n  }\n  return false;\n}\n","import cy from 'cytoscape';\nimport { ICanvasLayer, IHTMLLayer, ISVGLayer, ILayer } from '../layers';\nimport { SVG_NS } from '../layers/SVGLayer';\nimport { matchNodes, registerCallback, ICallbackRemover, IMatchOptions } from './utils';\nimport { IElementLayerOptions, defaultElementLayerOptions } from './common';\n\nexport interface INodeLayerOption extends IElementLayerOptions {\n  /**\n   * how to compute the bounding box\n   */\n  boundingBox: cy.BoundingBoxOptions;\n  /**\n   * where to position the canvas / node relative to a node\n   */\n  position: 'none' | 'top-left' | 'center';\n  /**\n   * init function for the collection\n   * @param nodes\n   */\n  initCollection(nodes: cy.NodeCollection): void;\n}\n\nexport interface INodeDOMLayerOption<T extends HTMLElement | SVGElement> extends INodeLayerOption {\n  /**\n   * whether to use unique DOM elements per node (id), similar to D3 key argument\n   * @default false\n   */\n  uniqueElements: boolean;\n  /**\n   * init function for newly created DOM elements\n   * @param elem\n   * @param node\n   */\n  init(elem: T, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH): void;\n\n  /**\n   * additional transform to apply to a node\n   */\n  transform?: string;\n}\n\nexport interface INodeCanvasLayerOption extends INodeLayerOption {\n  /**\n   * init function for newly added node\n   * @param elem\n   * @param node\n   */\n  init(node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH): void;\n}\n\nexport interface IRenderPerNodeResult extends ICallbackRemover {\n  layer: ILayer;\n  nodes: cy.NodeCollection;\n}\n\nexport function renderPerNode(\n  layer: ICanvasLayer,\n  render: (ctx: CanvasRenderingContext2D, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => void,\n  options?: Partial<INodeCanvasLayerOption>\n): IRenderPerNodeResult;\nexport function renderPerNode(\n  layer: IHTMLLayer,\n  render: (elem: HTMLElement, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => void,\n  options?: Partial<INodeDOMLayerOption<HTMLElement>>\n): IRenderPerNodeResult;\nexport function renderPerNode(\n  layer: ISVGLayer,\n  render: (elem: SVGElement, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => void,\n  options?: Partial<INodeDOMLayerOption<SVGElement>>\n): IRenderPerNodeResult;\nexport function renderPerNode(\n  layer: ICanvasLayer | IHTMLLayer | ISVGLayer,\n  render: (ctx: any, node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => void,\n  options: Partial<INodeDOMLayerOption<any> | INodeCanvasLayerOption> = {}\n): IRenderPerNodeResult {\n  const o = Object.assign(\n    {\n      transform: '',\n      position: 'top-left',\n      boundingBox: {\n        includeLabels: false,\n        includeOverlays: false,\n      },\n      uniqueElements: false,\n      initCollection: () => undefined,\n    },\n    defaultElementLayerOptions(options),\n    options\n  );\n  const nodes = o.queryEachTime ? layer.cy.collection() : layer.cy.nodes(o.selector);\n  if (!o.queryEachTime) {\n    o.initCollection(nodes);\n  }\n  if (o.updateOn === 'render') {\n    layer.updateOnRender = true;\n  } else if (o.updateOn === 'position') {\n    nodes.on('position add remove', layer.update);\n  } else {\n    nodes.on('add remove', layer.update);\n  }\n\n  const wrapResult = (v: ICallbackRemover): IRenderPerNodeResult => ({\n    layer,\n    nodes,\n    remove: () => {\n      nodes.off('position add remove', undefined, layer.update);\n      v.remove();\n    },\n  });\n\n  if (layer.type === 'canvas') {\n    const oCanvas = o as INodeCanvasLayerOption;\n    const renderer = (ctx: CanvasRenderingContext2D) => {\n      const t = ctx.getTransform();\n      const currentNodes = oCanvas.queryEachTime ? layer.cy.nodes(oCanvas.selector) : nodes;\n      if (o.queryEachTime) {\n        o.initCollection(currentNodes);\n      }\n      currentNodes.forEach((node) => {\n        const bb = node.boundingBox(o.boundingBox);\n        if (oCanvas.checkBounds && !layer.inVisibleBounds(bb)) {\n          return;\n        }\n        if (oCanvas.position === 'top-left') {\n          ctx.translate(bb.x1, bb.y1);\n        } else if (oCanvas.position === 'center') {\n          const pos = node.position();\n          ctx.translate(pos.x, pos.y);\n        }\n        render(ctx, node, bb);\n        if (oCanvas.position !== 'none') {\n          ctx.setTransform(t);\n        }\n      });\n    };\n    return wrapResult(registerCallback(layer, renderer));\n  }\n\n  const oDOM = o as INodeDOMLayerOption<any>;\n  // HTML or SVG\n  const baseOptions = {\n    bb: (node: cy.NodeSingular) => node.boundingBox(oDOM.boundingBox),\n    isVisible: oDOM.checkBounds ? (bb: cy.BoundingBox12 & cy.BoundingBoxWH) => layer.inVisibleBounds(bb) : () => true,\n    uniqueElements: oDOM.uniqueElements === true,\n  };\n  if (oDOM.checkBounds) {\n    layer.updateOnTransform = true;\n  }\n\n  if (layer.type === 'html') {\n    const matchOptions: IMatchOptions<HTMLElement> = {\n      ...baseOptions,\n      enter: (node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => {\n        const r = layer.node.ownerDocument.createElement('div');\n        r.style.position = 'absolute';\n        if (oDOM.init) {\n          oDOM.init(r, node, bb);\n        }\n        return r;\n      },\n      update: (elem, node, bb) => {\n        if (oDOM.position === 'top-left') {\n          elem.style.transform = `${oDOM.transform}translate(${bb.x1}px,${bb.y1}px)`;\n        } else if (oDOM.position === 'center') {\n          const pos = node.position();\n          elem.style.transform = `${oDOM.transform}translate(${pos.x}px,${pos.y}px)`;\n        }\n        render(elem, node, bb);\n      },\n    };\n    const renderer = (root: HTMLElement) => {\n      const currentNodes = oDOM.queryEachTime ? layer.cy.nodes(oDOM.selector) : nodes;\n      if (o.queryEachTime) {\n        o.initCollection(currentNodes);\n      }\n      matchNodes(root, currentNodes, matchOptions);\n    };\n    return wrapResult(registerCallback(layer, renderer));\n  }\n\n  // if (layer.type === 'svg') {\n  const matchOptions: IMatchOptions<SVGElement> = {\n    ...baseOptions,\n    enter: (node: cy.NodeSingular, bb: cy.BoundingBox12 & cy.BoundingBoxWH) => {\n      const r = layer.node.ownerDocument.createElementNS(SVG_NS, 'g');\n      if (oDOM.init) {\n        oDOM.init(r, node, bb);\n      }\n      return r;\n    },\n    update: (elem, node, bb) => {\n      if (oDOM.position === 'top-left') {\n        elem.setAttribute('transform', `${oDOM.transform}translate(${bb.x1},${bb.y1})`);\n      } else if (oDOM.position === 'center') {\n        const pos = node.position();\n        elem.setAttribute('transform', `${oDOM.transform}translate(${pos.x},${pos.y})`);\n      }\n      render(elem, node, bb);\n    },\n  };\n  const renderer = (root: SVGElement) => {\n    const currentNodes = oDOM.queryEachTime ? layer.cy.nodes(oDOM.selector) : nodes;\n    if (o.queryEachTime) {\n      o.initCollection(currentNodes);\n    }\n    matchNodes(root, currentNodes, matchOptions);\n  };\n  return wrapResult(registerCallback(layer, renderer));\n}\n","import cy from 'cytoscape';\nimport {\n  HTMLLayer,\n  ICytoscapeDragLayer,\n  ICytoscapeNodeLayer,\n  ICytoscapeSelectBoxLayer,\n  ILayer,\n  ISVGLayer,\n  ICanvasLayer,\n  IHTMLLayer,\n  CytoscapeNodeLayer,\n  CytoscapeDragLayer,\n  CytoscapeSelectBoxLayer,\n  ILayerImpl,\n  ILayerElement,\n  CanvasLayer,\n  SVGLayer,\n  IMoveAbleLayer,\n  SVGStaticLayer,\n  HTMLStaticLayer,\n  ISVGStaticLayer,\n  IHTMLStaticLayer,\n  CanvasStaticLayer,\n  ICanvasStaticLayer,\n  IHTMLLayerOptions,\n  ISVGLayerOptions,\n  ICanvasLayerOptions,\n  IPoint,\n} from './layers';\nimport { ILayerAdapter } from './layers/ABaseLayer';\nimport { renderPerEdge, renderPerNode } from './elements';\n\nfunction isPoint(p: IPoint | cy.BoundingBox12): p is IPoint {\n  return (p as IPoint).x != null;\n}\n\nexport default class LayersPlugin {\n  readonly cy: cy.Core;\n\n  readonly nodeLayer: ICytoscapeNodeLayer;\n  readonly dragLayer: ICytoscapeDragLayer;\n  readonly selectBoxLayer: ICytoscapeSelectBoxLayer;\n\n  private readonly adapter: ILayerAdapter;\n\n  private readonly viewport: { width: number; height: number; tx: number; ty: number; zoom: number };\n\n  constructor(cy: cy.Core) {\n    this.cy = cy;\n    this.adapter = {\n      cy: this.cy,\n      insert: (where: 'before' | 'after', layer: IMoveAbleLayer, type) =>\n        this.insert(where, layer as ILayer & ILayerImpl, type),\n      move: (layer: IMoveAbleLayer, offset) => this.move(layer as ILayer & ILayerImpl, offset),\n      inVisibleBounds: (p: IPoint | cy.BoundingBox12) => {\n        const v = this.viewport;\n        const inX = (x: number) => {\n          const xp = x * v.zoom + v.tx;\n          return xp >= 0 && xp <= v.width;\n        };\n        const inY = (y: number) => {\n          const yp = y * v.zoom + v.ty;\n          return yp >= 0 && yp <= v.height;\n        };\n        if (isPoint(p)) {\n          return inX(p.x) && inY(p.y);\n        }\n        // any of the four corners or the center are inside\n        return (\n          (inX(p.x1) && inY(p.y1)) ||\n          (inX(p.x2) && inY(p.y1)) ||\n          (inX(p.x2) && inY(p.y2)) ||\n          (inX(p.x1) && inY(p.y2)) ||\n          (inX((p.x1 + p.x2) / 2) && inY((p.y1 + p.y2) / 2))\n        );\n      },\n    };\n\n    const container = cy.container()!;\n\n    const nodeLayer = new CytoscapeNodeLayer(\n      this.adapter,\n      container.querySelector<HTMLCanvasElement>('[data-id=\"layer2-node\"]')!\n    );\n    this.nodeLayer = nodeLayer;\n\n    const dragLayer = new CytoscapeDragLayer(\n      this.adapter,\n      container.querySelector<HTMLCanvasElement>('[data-id=\"layer1-drag\"]')!\n    );\n    this.dragLayer = dragLayer;\n\n    const selectBoxLayer = new CytoscapeSelectBoxLayer(\n      this.adapter,\n      container.querySelector<HTMLCanvasElement>('[data-id=\"layer0-selectbox\"]')!\n    );\n    this.selectBoxLayer = selectBoxLayer;\n\n    nodeLayer.root.style.zIndex = '';\n    dragLayer.root.style.zIndex = '';\n    selectBoxLayer.root.style.zIndex = '';\n    nodeLayer.root.insertAdjacentElement('afterend', dragLayer.root);\n    dragLayer.root.insertAdjacentElement('afterend', selectBoxLayer.root);\n\n    cy.on('viewport', this.zoomed);\n    cy.on('resize', this.resize);\n    cy.on('destroy', this.destroy);\n\n    this.viewport = {\n      width: this.cy.width(),\n      height: this.cy.height(),\n      tx: this.cy.pan().x,\n      ty: this.cy.pan().y,\n      zoom: this.cy.zoom(),\n    };\n  }\n\n  private move(layer: ILayer & ILayerImpl, offset: number) {\n    const l = this.layers;\n    const index = l.indexOf(layer);\n    const target = Math.max(Math.min(index + offset, l.length, 0));\n    if (target === index) {\n      return;\n    }\n    if (index >= l.length - 1) {\n      this.root.appendChild(layer.root);\n    } else {\n      this.root.insertBefore(layer.root, l[target].root);\n    }\n  }\n\n  get document() {\n    return this.cy.container()!.ownerDocument;\n  }\n\n  get root() {\n    return this.nodeLayer.node.parentElement! as HTMLElement;\n  }\n\n  private get layers(): readonly (ILayer & ILayerImpl)[] {\n    return Array.from(this.root.children)\n      .map((d) => ((d as unknown) as ILayerElement).__cy_layer)\n      .filter((d) => d != null);\n  }\n\n  getLayers(): readonly ILayer[] {\n    return this.layers;\n  }\n\n  private readonly resize = () => {\n    const width = this.cy.width();\n    const height = this.cy.height();\n    this.viewport.width = width;\n    this.viewport.height = height;\n\n    for (const layer of this.layers) {\n      layer.resize(width, height);\n    }\n  };\n\n  private readonly destroy = () => {\n    for (const layer of this.layers) {\n      layer.remove();\n    }\n\n    this.cy.off('destroy', undefined, this.destroy);\n    this.cy.off('viewport', undefined, this.zoomed);\n    this.cy.off('resize', undefined, this.resize);\n    this.cy.scratch('_layers', undefined);\n  };\n\n  private readonly zoomed = () => {\n    const pan = this.cy.pan();\n    const zoom = this.cy.zoom();\n    this.viewport.tx = pan.x;\n    this.viewport.ty = pan.y;\n    this.viewport.zoom = zoom;\n\n    for (const layer of this.layers) {\n      layer.setViewport(pan.x, pan.y, zoom);\n    }\n  };\n\n  private init<T extends ILayer & ILayerImpl>(layer: T): T {\n    layer.resize(this.viewport.width, this.viewport.height);\n    layer.setViewport(this.viewport.tx, this.viewport.ty, this.viewport.zoom);\n    return layer;\n  }\n\n  update() {\n    this.zoomed();\n    for (const layer of this.layers) {\n      if (layer instanceof CanvasLayer) {\n        layer.draw();\n      }\n    }\n  }\n\n  private createLayer(\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ) {\n    switch (type) {\n      case 'svg':\n        return this.init(new SVGLayer(this.adapter, this.document, options));\n      case 'html':\n        return this.init(new HTMLLayer(this.adapter, this.document, options));\n      case 'canvas':\n        return this.init(new CanvasLayer(this.adapter, this.document, options));\n      case 'html-static':\n        return this.init(new HTMLStaticLayer(this.adapter, this.document, options));\n      case 'svg-static':\n        return this.init(new SVGStaticLayer(this.adapter, this.document, options));\n      case 'canvas-static':\n        return this.init(new CanvasStaticLayer(this.adapter, this.document, options));\n    }\n  }\n\n  append(type: 'svg', options?: ISVGLayerOptions): ISVGLayer;\n  append(type: 'svg-static', options?: ISVGLayerOptions): ISVGStaticLayer;\n  append(type: 'canvas', options?: ICanvasLayerOptions): ICanvasLayer;\n  append(type: 'canvas-static', options?: ICanvasLayerOptions): ICanvasStaticLayer;\n  append(type: 'html', options?: IHTMLLayerOptions): IHTMLLayer;\n  append(type: 'html-static', options?: IHTMLLayerOptions): IHTMLStaticLayer;\n  append(\n    type: 'svg' | 'html' | 'canvas' | 'canvas-static' | 'svg-static' | 'html-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ) {\n    const layer = this.createLayer(type, options);\n    this.root.appendChild(layer.root);\n    return layer as any;\n  }\n\n  insert(where: 'before' | 'after', layer: ILayer & ILayerImpl, type: 'svg', options?: ISVGLayerOptions): ISVGLayer;\n  insert(\n    where: 'before' | 'after',\n    layer: ILayer & ILayerImpl,\n    type: 'svg-static',\n    options?: ISVGLayerOptions\n  ): ISVGStaticLayer;\n  insert(\n    where: 'before' | 'after',\n    layer: ILayer & ILayerImpl,\n    type: 'canvas',\n    options?: ICanvasLayerOptions\n  ): ICanvasLayer;\n  insert(\n    where: 'before' | 'after',\n    layer: ILayer & ILayerImpl,\n    type: 'canvas-static',\n    options?: ICanvasLayerOptions\n  ): ICanvasStaticLayer;\n  insert(where: 'before' | 'after', layer: ILayer & ILayerImpl, type: 'html', options?: IHTMLLayerOptions): IHTMLLayer;\n  insert(\n    where: 'before' | 'after',\n    layer: ILayer & ILayerImpl,\n    type: 'html-static',\n    options?: IHTMLLayerOptions\n  ): IHTMLStaticLayer;\n  insert(\n    where: 'before' | 'after',\n    layer: ILayer & ILayerImpl,\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ): ISVGLayer | ICanvasLayer | IHTMLLayer;\n  insert(\n    where: 'before' | 'after',\n    ref: ILayer & ILayerImpl,\n    type: 'svg' | 'html' | 'canvas' | 'svg-static' | 'html-static' | 'canvas-static',\n    options?: IHTMLLayerOptions | ISVGLayerOptions | ICanvasLayerOptions\n  ) {\n    const layer = this.createLayer(type, options);\n    ref.root.insertAdjacentElement(where === 'before' ? 'beforebegin' : 'afterend', layer.root);\n    return layer as any;\n  }\n\n  getLast(): ILayer | null {\n    const layers = this.layers;\n    return layers[layers.length - 1] ?? null;\n  }\n\n  getFirst(): ILayer | null {\n    const layers = this.layers;\n    return layers[0] ?? null;\n  }\n\n  readonly renderPerEdge = renderPerEdge;\n  readonly renderPerNode = renderPerNode;\n}\n\nexport function layers(this: cy.Core): LayersPlugin;\nexport function layers(cy: cy.Core): LayersPlugin;\nexport function layers(this: cy.Core, cy: cy.Core = this) {\n  if (!cy.container()) {\n    throw new Error('layers plugin does not work in headless environments');\n  }\n  // ensure just one instance exists\n  const singleton = cy.scratch('_layers') as LayersPlugin;\n  if (singleton) {\n    return singleton;\n  }\n  const plugin = new LayersPlugin(cy);\n  cy.scratch('_layers', plugin);\n  return plugin;\n}\n","import { layers } from './LayersPlugin';\nexport * from './LayersPlugin';\nexport { default as LayersPlugin } from './LayersPlugin';\nexport * from './elements';\nexport * from './layers/public';\n\nexport default function register(\n  cytoscape: (type: 'core' | 'collection' | 'layout', name: string, extension: any) => void\n) {\n  cytoscape('core', 'layers', layers);\n}\n\n// auto register\nif (typeof (window as any).cytoscape !== 'undefined') {\n  register((window as any).cytoscape);\n}\n\nexport declare namespace cytoscape {\n  type Ext2 = (cytoscape: (type: 'core' | 'collection' | 'layout', name: string, extension: any) => void) => void;\n  function use(module: Ext2): void;\n\n  interface Core {\n    layers: typeof layers;\n  }\n}\n"],"names":["layerStyle","position","left","top","userSelect","outlineStyle","width","height","stop","e","stopPropagation","stopClicks","node","addEventListener","ABaseLayer","constructor","adapter","inVisibleBounds","p","updateOnRender","updateOnRenderEnabled","value","cy","on","update","off","undefined","moveUp","move","moveDown","moveBack","Number","NEGATIVE_INFINITY","moveFront","POSITIVE_INFINITY","insertBefore","type","options","insert","insertAfter","ADOMBaseLayer","root","o","callbacks","Object","assign","style","visible","display","show","hide","callback","push","resize","remove","SVG_NS","SVGLayer","doc","createElementNS","__cy_layer","appendChild","setViewport","tx","ty","zoom","setAttribute","updateOnTransform","SVGStaticLayer","CanvasBaseLayer","draw","createElement","pixelRatio","window","devicePixelRatio","ctx","getContext","resetTransform","clear","bak","getTransform","clearRect","canvas","setTransform","save","scale","translate","transform","r","restore","_tx","_ty","_zoom","CanvasLayer","CanvasStaticLayer","HTMLLayer","HTMLStaticLayer","CytoscapeBaseLayer","CytoscapeNodeLayer","CytoscapeDragLayer","CytoscapeSelectBoxLayer","matchNodes","nodes","arr","Array","from","children","uniqueElements","forEach","bb","isVisible","length","shift","elem","enter","rest","map","Map","d","dataset","id","i","expected","has","get","n","delete","insertAdjacentElement","splice","registerCallback","layer","renderer","indexOf","defaultElementLayerOptions","selector","updateOn","queryEachTime","checkBounds","renderPerEdge","render","checkBoundsPointCount","initCollection","edges","collection","sources","targets","currentEdges","edge","impl","_private","rscratch","s","startX","startY","x","y","sourceEndpoint","t","endX","endY","targetEndpoint","anyVisible","pathCache","path","Path2D","moveTo","lineTo","count","interpolate","v","step","renderPerNode","boundingBox","includeLabels","includeOverlays","wrapResult","oCanvas","currentNodes","x1","y1","pos","oDOM","baseOptions","matchOptions","ownerDocument","init","isPoint","LayersPlugin","viewport","layers","destroy","zoomed","scratch","pan","where","offset","inX","xp","inY","yp","x2","y2","container","nodeLayer","querySelector","dragLayer","selectBoxLayer","zIndex","l","index","target","Math","max","min","document","parentElement","filter","getLayers","createLayer","append","ref","getLast","getFirst","Error","singleton","plugin","register","cytoscape"],"mappings":"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"}